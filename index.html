<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRADE ARMY | V.2 - FULL PERSISTENCE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body { background: #0c0d10; margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; color: #d1d4dc; font-family: 'Inter', sans-serif; }
        #chart-container { flex: 1; position: relative; background: #1e222d; }
        #chart-grid { display: grid; height: 100%; width: 100%; gap: 1px; }
        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        
        .control-btn { background: #1e222d; color: #81858e; border: 1px solid #2a2e39; padding: 6px 14px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer; }
        .active-layout { background: #2962ff !important; color: white !important; border-color: #2962ff; }
        
        .side-panel { width: 280px; background: #131722; border-left: 1px solid #1e222d; transition: all 0.3s ease; }
        .side-panel.closed { width: 0; opacity: 0; pointer-events: none; }
        
        iframe { width: 100% !important; height: 100% !important; border: none !important; }
    </style>
</head>
<body class="flex flex-col">

    <div class="h-[40px] bg-[#131722] border-b border-[#1e222d] shrink-0">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
            { "symbols": [{"proName": "BINANCE:BTCUSDT", "title": "BTC"}, {"proName": "NASDAQ:IXIC", "title": "NASDAQ"}, {"proName": "TVC:GOLD", "title": "ALTIN"}], "colorTheme": "dark", "isTransparent": true, "locale": "tr" }
            </script>
        </div>
    </div>

    <header class="h-16 border-b border-[#1e222d] bg-[#131722] flex items-center justify-between px-4 shrink-0 z-50">
        <div class="flex items-center space-x-6">
            <div class="flex flex-col">
                <span class="text-white font-black italic text-xl tracking-tighter uppercase">TRADE ARMY</span>
                <span class="text-blue-500 text-[10px] font-bold tracking-[3px]">SYNC V.2</span>
            </div>
            
            <div class="flex space-x-1 bg-black/30 p-1 rounded-md border border-gray-800">
                <button id="l-1" onclick="setLayout(1)" class="control-btn">1</button>
                <button id="l-2" onclick="setLayout(2)" class="control-btn">2</button>
                <button id="l-4" onclick="setLayout(4)" class="control-btn">4</button>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="hidden md:flex flex-col items-end mr-4">
                <span id="clock" class="text-white font-mono text-sm font-bold">00:00:00</span>
                <span class="text-[9px] text-green-500 font-bold uppercase tracking-widest">CanlÄ± Senkronize</span>
            </div>
            <button onclick="togglePanel()" class="control-btn">ALARMLAR</button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-16 border-r border-[#1e222d] bg-[#0c0d10] flex flex-col items-center py-6 space-y-8 shrink-0">
            <button onclick="syncSymbol('BINANCE:BTCUSDT')" class="hover:scale-125 transition">â‚¿</button>
            <button onclick="syncSymbol('NASDAQ:IXIC')" class="hover:scale-125 transition">ðŸ“ˆ</button>
            <button onclick="syncSymbol('TVC:GOLD')" class="hover:scale-125 transition">ðŸŸ¡</button>
            <button onclick="speak('Sistem aktif')" class="text-xs opacity-50">ðŸ”Š</button>
        </aside>

        <main id="chart-container">
            <div id="chart-grid" class="grid-1">
                <div id="grid_1"></div>
                <div id="grid_2" class="hidden"></div>
                <div id="grid_3" class="hidden"></div>
                <div id="grid_4" class="hidden"></div>
            </div>
        </main>

        <aside id="side-panel" class="side-panel p-4 overflow-y-auto">
            <div class="mb-6">
                <h3 class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-4">HÄ±zlÄ± Alarm Kur</h3>
                <input type="text" id="a-sym" placeholder="BTCUSDT" class="w-full bg-black/40 border border-gray-800 p-2 rounded text-sm mb-2 outline-none text-blue-400 font-bold uppercase">
                <input type="number" id="a-price" placeholder="Fiyat" class="w-full bg-black/40 border border-gray-800 p-2 rounded text-sm mb-3 outline-none">
                <button onclick="addAlarm()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 rounded text-xs transition">ALARM EKLE</button>
            </div>
            <div id="alarm-list" class="space-y-2"></div>
        </aside>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        // HAFIZA AYARLARI
        let state = JSON.parse(localStorage.getItem('ta_state')) || {
            layout: 1,
            symbol: 'BINANCE:BTCUSDT',
            panelOpen: true
        };
        let alarms = JSON.parse(localStorage.getItem('ta_alarms')) || [];

        function saveState() { localStorage.setItem('ta_state', JSON.stringify(state)); }
        function saveAlarms() { localStorage.setItem('ta_alarms', JSON.stringify(alarms)); }

        function speak(t) { 
            const u = new SpeechSynthesisUtterance(t); u.lang = 'tr-TR'; window.speechSynthesis.speak(u); 
        }

        // GRAFÄ°K OLUÅžTURUCU (Renklerin korunmasÄ± iÃ§in 'autosize' ve 'theme' kritik)
        function createChart(id, sym) {
            return new TradingView.widget({
                "autosize": true,
                "symbol": sym,
                "interval": "60",
                "timezone": "Europe/Istanbul",
                "theme": "dark",
                "style": "1",
                "locale": "tr",
                "toolbar_bg": "#131722",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "container_id": id,
                "withdateranges": true,
                "details": true,
                "hotlist": true,
                "calendar": true,
                "show_popup_button": true,
                "popup_width": "1000",
                "popup_height": "650"
            });
        }

        // EKRAN DÃœZENÄ°
        function setLayout(n) {
            state.layout = n;
            saveState();
            
            const grid = document.getElementById('chart-grid');
            grid.className = `grid-${n}`;
            
            // Buton aktiflik sÄ±nÄ±flarÄ±
            [1,2,4].forEach(i => document.getElementById(`l-${i}`).classList.remove('active-layout'));
            document.getElementById(`l-${n}`).classList.add('active-layout');

            for (let i = 1; i <= 4; i++) {
                const div = document.getElementById(`grid_${i}`);
                if (i <= n) {
                    div.classList.remove('hidden');
                    createChart(`grid_${i}`, state.symbol);
                } else {
                    div.classList.add('hidden');
                    div.innerHTML = "";
                }
            }
        }

        // SENKRONÄ°ZE SEMBOL DEÄžÄ°ÅžÄ°MÄ°
        function syncSymbol(s) {
            state.symbol = s;
            saveState();
            for (let i = 1; i <= state.layout; i++) {
                createChart(`grid_${i}`, s);
            }
            speak(s.split(':')[1] + " yÃ¼klendi.");
        }

        // ALARM Ä°ÅžLEMLERÄ°
        function addAlarm() {
            const s = document.getElementById('a-sym').value.toUpperCase();
            const p = document.getElementById('a-price').value;
            if(!s || !p) return;
            alarms.push({ id: Date.now(), sym: s, price: p, active: true });
            saveAlarms();
            renderAlarms();
            speak(s + " alarmÄ± kuruldu.");
        }

        function renderAlarms() {
            const list = document.getElementById('alarm-list');
            list.innerHTML = alarms.map(a => `
                <div class="bg-black/40 border border-gray-800 p-3 rounded-lg flex justify-between items-center">
                    <div class="text-[11px] font-mono"><b>${a.sym}</b><br><span class="text-blue-500">${a.price}</span></div>
                    <button onclick="removeAlarm(${a.id})" class="text-red-500 font-bold text-xs">SÄ°L</button>
                </div>
            `).join('');
        }

        function removeAlarm(id) {
            alarms = alarms.filter(a => a.id !== id);
            saveAlarms();
            renderAlarms();
        }

        function togglePanel() {
            state.panelOpen = !state.panelOpen;
            saveState();
            document.getElementById('side-panel').classList.toggle('closed');
        }

        // SAAT
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);

        // AÃ‡ILIÅž
        window.onload = () => {
            if(!state.panelOpen) document.getElementById('side-panel').classList.add('closed');
            setLayout(state.layout);
            renderAlarms();
        };
    </script>
</body>
</html>
