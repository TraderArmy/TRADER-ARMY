<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRADE ARMY V1 | AUTO-LOGIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #08090d; color: #d1d4dc; font-family: sans-serif; overflow: hidden; height: 100vh; margin: 0; }
        
        /* GİRİŞ EKRANI */
        #login-overlay { position: fixed; inset: 0; background: #08090d; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .login-card { background: #131722; padding: 50px; border-radius: 30px; border: 1px solid #2962ff; text-align: center; box-shadow: 0 0 60px rgba(41, 98, 255, 0.1); }
        
        /* ANA TERMİNAL */
        #main-terminal { display: none; opacity: 0; flex-direction: column; height: 100vh; transition: 1s ease-in; }
        .header { height: 60px; background: #131722; border-bottom: 1px solid #2a2e39; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .chart-grid { flex: 1; display: grid; gap: 1px; background: #1e222d; }
        
        /* PROFİL */
        .user-profile { display: flex; align-items: center; background: #1e222d; padding: 6px 16px; border-radius: 50px; border: 1px solid #363a45; }
        .status-badge { width: 10px; height: 10px; background: #22c55e; border-radius: 50%; margin-right: 10px; box-shadow: 0 0 10px #22c55e; }
        
        /* YÜKLENİYOR EFEKTİ */
        .loader { border: 3px solid #1e222d; border-top: 3px solid #2962ff; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: none; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card">
            <h1 class="text-4xl font-black italic text-white uppercase tracking-tighter mb-2">TRADE ARMY <span class="text-blue-500">V1</span></h1>
            <p class="text-gray-500 text-sm mb-10 font-medium">Sistem senkronizasyon için giriş bekliyor...</p>
            
            <button id="loginBtn" onclick="openTVLogin()" class="bg-blue-600 hover:bg-blue-500 text-white font-black py-4 px-12 rounded-2xl transition-all shadow-lg shadow-blue-900/40 uppercase tracking-widest text-sm">
                TRADINGVIEW GİRİŞİ YAP
            </button>

            <div id="checkLoader" class="loader"></div>
            <p id="statusMsg" class="text-[10px] text-gray-600 mt-6 uppercase font-bold tracking-[0.2em]">Oturum Bekleniyor...</p>
        </div>
    </div>

    <div id="main-terminal">
        <header class="header">
            <div class="flex items-center space-x-4">
                <span class="text-white font-black italic tracking-tighter text-xl uppercase">Trade Army <span class="text-blue-500 text-xs">Pro</span></span>
                <div class="bg-black/40 p-1 rounded-lg border border-white/5 flex space-x-1 ml-4">
                    <button onclick="setGrid(1)" class="px-4 py-1 text-xs font-bold text-gray-500 hover:text-white">1</button>
                    <button onclick="setGrid(4)" class="px-4 py-1 text-xs font-bold text-blue-500 bg-blue-500/10 rounded">4</button>
                </div>
            </div>

            <div class="user-profile">
                <div class="status-badge"></div>
                <div class="text-left">
                    <div class="text-[9px] text-gray-500 font-bold uppercase">Bağlantı Kuruldu</div>
                    <div class="text-[11px] text-white font-black uppercase tracking-tight">ICT PROFİL AKTİF</div>
                </div>
            </div>
        </header>

        <main id="chart-grid" class="chart-grid grid-cols-2 grid-rows-2">
            <div id="box_1" class="w-full h-full"></div>
            <div id="box_2" class="w-full h-full"></div>
            <div id="box_3" class="w-full h-full"></div>
            <div id="box_4" class="w-full h-full"></div>
        </main>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let isChecking = false;

        function openTVLogin() {
            window.open('https://www.tradingview.com/accounts/signin/', '_blank');
            startAutoCheck();
        }

        // OTOMATİK KONTROL MEKANİZMASI
        function startAutoCheck() {
            if(isChecking) return;
            isChecking = true;
            
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('checkLoader').style.display = 'block';
            document.getElementById('statusMsg').innerText = "Giriş yapmanız bekleniyor, otomatik açılacak...";
            document.getElementById('statusMsg').classList.add('text-blue-500');

            // Kullanıcı sekmeye her döndüğünde kontrol et
            window.onfocus = function() {
                checkSessionAndUnlock();
            };
            
            // Periyodik kontrol
            setInterval(checkSessionAndUnlock, 3000);
        }

        function checkSessionAndUnlock() {
            // TradingView çerezleri sadece giriş yapıldığında bu izni verir
            // Burada teknik olarak "Giriş yapıldı" onayı simüle edilir
            // Sen sekmeye döndüğünde terminali açıyoruz
            unlock();
        }

        function unlock() {
            const overlay = document.getElementById('login-overlay');
            const terminal = document.getElementById('main-terminal');
            
            overlay.style.transform = 'translateY(-100%)';
            setTimeout(() => {
                overlay.style.display = 'none';
                terminal.style.display = 'flex';
                terminal.style.opacity = '1';
                setGrid(4);
            }, 800);
        }

        function setGrid(n) {
            const grid = document.getElementById('chart-grid');
            const symbols = ['CAPITALCOM:US100', 'FX:EURUSD', 'FX:GBPUSD', 'TVC:GOLD'];
            
            if(n === 1) grid.className = "chart-grid grid-cols-1 grid-rows-1";
            else grid.className = "chart-grid grid-cols-2 grid-rows-2";

            for(let i=1; i<=4; i++) {
                const box = document.getElementById('box_'+i);
                if(i <= n) {
                    box.style.display = 'block';
                    new TradingView.widget({
                        "autosize": true, "symbol": symbols[i-1], "interval": "1", "theme": "dark", "style": "1", "locale": "tr",
                        "container_id": "box_"+i, "hide_side_toolbar": false, "allow_symbol_change": true,
                        "remember_last_used_chart": true, "charts_storage_url": "https://saveload.tradingview.com",
                        "charts_storage_api_version": "1.1", "client_id": "tradingview.com", "user_id": "public_user_id",
                        "enabled_features": ["header_saveload", "auto_save_and_load_chart", "header_indicators", "header_resolutions"]
                    });
                } else {
                    box.style.display = 'none';
                }
            }
        }
    </script>
</body>
</html>
